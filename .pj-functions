#!/bin/bash
# Author: Paulo JerÃ´nimo (@paulojeronimo, pj@paulojeronimo.info)
# Some utility functions

# Default syntax for 'sed -i' command
export sed_i='sed -i'

# Specific dot file loaded by .bashrc or .profile for this system
export DOTSTART_FILE=~/.`hostname -s`

# Sample dot file used to create $DOTSTART_FILE if it does'nt exists
export SAMPLE_DOTSTART_FILE=~/.sample-pj

# Change some defaults for specific systems
case `uname` in
   Darwin)
      sed_i='sed -i ""'
      ;;
esac

# Insert code on .profile (or .bashrc) to load $DOTSTART_FILE file
dotstart_install() {
   local profile=~/.profile
   local search_str='# Load startup environment for this machine'

   case `uname` in
      Linux)
         profile=~/.bashrc
         ;;
   esac

   [ -f $profile ] || touch $profile

   grep "^$search_str" $profile &> /dev/null
   if [ $? = 1 ]; then
      echo "Changing $profile to load $DOTSTART_FILE file ..."
      echo -e "\n$search_str" >> $profile
      echo -e "f=$DOTSTART_FILE; [ -f \"\$f\" ] && source \"\$f\"" >> $profile
   fi
}

# Show PATH, one per line
showpath() {
   echo $PATH | tr : '\n'
}

# Change the loaded environment configured at this file
setenv() {
  local env=$1

  if [ -f "$env" ]; then
    $sed_i "s,^\(export ENVIRONMENT=\)\(.*\),\1$env,g" $DOTSTART_FILE
  else
    echo "The file \"$env\" does'nt exists! Nothing was done."
  fi
}

# Change the loaded proxy configured at this file
setproxy() {
  local proxy=$1

  $sed_i "s,^\(export PROXY=\)\(.*\),\1$proxy,g" $DOTSTART_FILE

  if [ ! -f "$proxy" ]; then
    echo "The file \"$proxy\" does'nt exists! Proxy settings will not be done."
  fi
}

# Install Java plugin for mozilla
java_mozilla_install() {
   local dir="$HOME/.mozilla/plugins"
   local plugin="$JAVA_HOME/jre/lib/amd64/libnpjp2.so"
   case `uname` in
      Darwin|Cygwin)
         echo 'This is a Linux specific function!'
         return
         ;;
   esac
   mkdir -p $dir && cd $dir
   if [ ! -f "$plugin" ]; then
      echo "The \"$plugin\" file was not found!"
      return 1
   fi
   ln -sf $plugin
   cd - &> /dev/null
}
