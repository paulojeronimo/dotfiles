#!/bin/bash
# Author: Paulo Jerônimo (@paulojeronimo, pj@paulojeronimo.info)

# Habilita mais mensagens se configurado para true
# Configure aqui, ou antes num dos arquivos de inicialização (~/.bashrc, ~/.profile)
VERBOSO=${VERBOSO:-false}

# Carrega variáveis e funções
f=~/.dotfiles/home; source $f || return $?
f=~/.funcoes/diversas.sh; source $f || return $?
carregar_arquivos_em ~/.{configuracoes,funcoes}{,/$PLATAFORMA} -i $f
unset f

# Configura o PATH
[[ $PLATAFORMA = Cygwin ]] && PATH=~/bin:$PATH
PATH=~/.scripts:$PATH
PATH=~/.scripts/`boot-gists`:$PATH
PATH=~/.scripts/docker:$PATH
[[ $PLATAFORMA = Linux ]] && PATH=~/.scripts/`distro`:$PATH
export PATH

# Ajusta e carrega o ambiente (se ele não for /dev/null)
export ENVIRONMENT=/dev/null
[ "$ENVIRONMENT" != /dev/null ] && [ -f "$ENVIRONMENT" ] && source "$ENVIRONMENT"

# Apresenta a data e a hora da sessão (se estivermos num login shell)
shopt -q login_shell && date +"Sessão iniciada em %F às %T"

[ "$USE_TMUX" ] || {
	[[ $OSTYPE =~ darwin ]] && USE_TMUX=true || USE_TMUX=false
}
! $USE_TMUX || {
	# Start TMUX (Ref: https://unix.stackexchange.com/a/113768)
	command -v tmux &> /dev/null && \
		[ -n "$PS1" ] && \
		[[ ! "$TERM" =~ screen ]] && \
		[[ ! "$TERM" =~ tmux ]] && \
		[ -z "$TMUX" ] && \
		exec tmux
}

! [ $PLATAFORMA = Linux ] || vm `vm-type`
